<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cargador de Im√°genes</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px;}
.container{max-width:1200px;margin:0 auto;}
.header{text-align:center;color:white;margin-bottom:30px;}
.header h1{font-size:2.5em;margin-bottom:10px;text-shadow:2px 2px 4px rgba(0,0,0,0.3);}
.search-box{background:white;border-radius:15px;padding:30px;box-shadow:0 10px 30px rgba(0,0,0,0.3);margin-bottom:30px;}
.input-group{display:flex;gap:10px;margin-bottom:15px;}
input[type="text"]{flex:1;padding:15px;border:2px solid #e0e0e0;border-radius:10px;font-size:16px;transition:border-color 0.3s;}
input[type="text"]:focus{outline:none;border-color:#667eea;}
button{padding:15px 30px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:white;border:none;border-radius:10px;font-size:16px;font-weight:bold;cursor:pointer;transition:transform 0.2s,box-shadow 0.2s;}
button:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,0,0,0.3);}
button:active{transform:translateY(0);}
button:disabled{opacity:0.6;cursor:not-allowed;}
.info{color:#666;font-size:14px;text-align:center;}
.status{text-align:center;color:white;font-size:18px;margin-bottom:20px;min-height:30px;}
.download-section{text-align:center;margin-bottom:20px;}
.download-btn{margin:0 5px;}
.switch-container{display:flex;align-items:center;justify-content:center;gap:10px;margin-top:15px;padding-top:15px;border-top:1px solid #e0e0e0;}
.switch-label{color:#666;font-size:14px;font-weight:500;}
.switch{position:relative;display:inline-block;width:50px;height:26px;}
.switch input{opacity:0;width:0;height:0;}
.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;transition:0.4s;border-radius:26px;}
.slider:before{position:absolute;content:"";height:18px;width:18px;left:4px;bottom:4px;background-color:white;transition:0.4s;border-radius:50%;}
input:checked+.slider{background-color:#667eea;}
input:checked+.slider:before{transform:translateX(24px);}
.gallery{display:flex;flex-direction:column;gap:0;max-width:800px;margin:0 auto;}
.image-card{background:white;overflow:hidden;position:relative;cursor:pointer;transition:opacity 0.3s;}
.image-card.preview{box-shadow:0 5px 15px rgba(0,0,0,0.2);border-radius:10px;margin-bottom:20px;}
.image-card.preview:hover{opacity:0.95;}
.image-card img{width:100%;display:block;}
.image-number{position:absolute;bottom:5px;right:5px;color:white;font-size:18px;font-weight:bold;text-shadow:2px 2px 4px rgba(0,0,0,0.8);opacity:0.7;}
.click-hint{position:absolute;bottom:15px;left:50%;transform:translateX(-50%);background:rgba(102,126,234,0.95);color:white;padding:12px 30px;border-radius:25px;font-size:16px;font-weight:bold;box-shadow:0 4px 10px rgba(0,0,0,0.3);pointer-events:none;}
.fullscreen-overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.95);z-index:1000;overflow-y:auto;}
.fullscreen-overlay.active{display:block;}
.fullscreen-close{position:fixed;top:20px;right:20px;background:rgba(255,255,255,0.2);color:white;border:none;padding:15px 25px;border-radius:10px;font-size:20px;cursor:pointer;z-index:1001;transition:background 0.3s;}
.fullscreen-close:hover{background:rgba(255,255,255,0.3);}
.fullscreen-gallery{display:flex;flex-direction:column;gap:0;padding:20px 0;}
.fullscreen-image{width:100%;display:block;}
.loading{text-align:center;color:white;font-size:20px;}
.loading::after{content:'...';animation:dots 1.5s steps(4,end) infinite;}
@keyframes dots{0%,20%{content:'.';}40%{content:'..';}60%,100%{content:'...';}}
</style>
</head>
<body>
<div class="container">
<div class="header">
<h1>üñºÔ∏è Cargador de Im√°genes</h1>
<p>Carga im√°genes individuales o secuencias autom√°ticas</p>
</div>
<div class="search-box">
<div class="input-group">
<input type="text" id="urlInput" placeholder="Ingresa la URL (usa {N} para secuencias: ejemplo.com/img/{N}.jpg)">
<button id="loadBtn" onclick="loadImages()">Cargar</button>
</div>
<div class="info">üí° Usa {N} para cargar secuencias autom√°ticas. Detecta formatos 1,2,3... o 01,02,03...</div>
<div class="switch-container">
<span class="switch-label">üåê Usar CORS Proxy</span>
<label class="switch">
<input type="checkbox" id="corsToggle" onchange="toggleCorsProxy()">
<span class="slider"></span>
</label>
</div>
<div class="switch-container">
<span class="switch-label">üîÑ Auto-detectar patrones</span>
<label class="switch">
<input type="checkbox" id="autoPatternToggle" onchange="toggleAutoPattern()">
<span class="slider"></span>
</label>
</div>
</div>
<div class="status" id="status"></div>
<div class="download-section" id="downloadSection" style="display:none;">
<button class="download-btn" onclick="downloadAll()">üì• Descargar ZIP</button>
</div>
<div class="gallery" id="gallery"></div>
</div>
<div class="fullscreen-overlay" id="fullscreenOverlay">
<button class="fullscreen-close" onclick="closeFullscreen()">‚úï Cerrar</button>
<div class="fullscreen-gallery" id="fullscreenGallery"></div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script>
let isLoading=false;
let allImages=[];
let showingAll=false;
let currentImageUrl='';
let useCorsProxy=false;
let useAutoPattern=false;
const corsProxies=['https://corsproxy.io/?','https://api.allorigins.win/raw?url=',''];
let currentProxyIndex=0;
let db;
function initDB(){
const request=indexedDB.open('ImageLoaderDB',3);
request.onerror=()=>console.error('Error abriendo IndexedDB');
request.onsuccess=(e)=>{
db=e.target.result;
loadSettings();
};
request.onupgradeneeded=(e)=>{
db=e.target.result;
if(!db.objectStoreNames.contains('settings')){
db.createObjectStore('settings',{keyPath:'key'});
}
if(!db.objectStoreNames.contains('patterns')){
db.createObjectStore('patterns',{keyPath:'pattern'});
}
if(!db.objectStoreNames.contains('images')){
db.createObjectStore('images',{keyPath:'url'});
}
};
}
function loadSettings(){
if(!db)return;
const transaction=db.transaction(['settings'],'readonly');
const store=transaction.objectStore('settings');
const corsRequest=store.get('useCorsProxy');
corsRequest.onsuccess=(e)=>{
if(e.target.result){
useCorsProxy=e.target.result.value;
document.getElementById('corsToggle').checked=useCorsProxy;
}
};
const patternRequest=store.get('useAutoPattern');
patternRequest.onsuccess=(e)=>{
if(e.target.result){
useAutoPattern=e.target.result.value;
document.getElementById('autoPatternToggle').checked=useAutoPattern;
}
};
}
function saveSettings(){
if(!db)return;
const transaction=db.transaction(['settings'],'readwrite');
const store=transaction.objectStore('settings');
store.put({key:'useCorsProxy',value:useCorsProxy});
store.put({key:'useAutoPattern',value:useAutoPattern});
}
function toggleCorsProxy(){
useCorsProxy=document.getElementById('corsToggle').checked;
saveSettings();
}
function toggleAutoPattern(){
useAutoPattern=document.getElementById('autoPatternToggle').checked;
saveSettings();
}
async function cacheSequence(pattern,imageUrls){
if(!db)return;
const transaction=db.transaction(['images'],'readwrite');
const store=transaction.objectStore('images');
store.put({url:pattern,images:imageUrls,timestamp:Date.now()});
}
async function getCachedSequence(pattern){
if(!db)return null;
return new Promise((resolve)=>{
const transaction=db.transaction(['images'],'readonly');
const store=transaction.objectStore('images');
const request=store.get(pattern);
request.onsuccess=(e)=>{
if(e.target.result){
resolve(e.target.result.images);
}else{
resolve(null);
}
};
request.onerror=()=>resolve(null);
});
}
function savePattern(patternUrl){
if(!db||!patternUrl.includes('{N}'))return;
const transaction=db.transaction(['patterns'],'readwrite');
const store=transaction.objectStore('patterns');
store.put({pattern:patternUrl,timestamp:Date.now()});
}
function extractPattern(url){
const parts=url.split('/');
const lastPart=parts[parts.length-1];
const numberMatch=lastPart.match(/\d+/);
if(!numberMatch)return null;
const basePath=parts.slice(0,-1).join('/');
const fileName=lastPart.replace(/\d+/,'{N}');
return `${basePath}/${fileName}`;
}
async function findMatchingPattern(url){
if(!db||!useAutoPattern)return null;
return new Promise((resolve)=>{
const transaction=db.transaction(['patterns'],'readonly');
const store=transaction.objectStore('patterns');
const request=store.openCursor();
const patterns=[];
request.onsuccess=(e)=>{
const cursor=e.target.result;
if(cursor){
patterns.push(cursor.value.pattern);
cursor.continue();
}else{
for(const pattern of patterns){
const regex=pattern.replace('{N}','(\\d+)');
const match=url.match(new RegExp(regex));
if(match){
resolve(pattern);
return;
}
}
resolve(null);
}
};
request.onerror=()=>resolve(null);
});
}
async function loadImages(){
if(isLoading)return;
let url=document.getElementById('urlInput').value.trim();
const status=document.getElementById('status');
const gallery=document.getElementById('gallery');
const loadBtn=document.getElementById('loadBtn');
const downloadSection=document.getElementById('downloadSection');
if(!url){status.textContent='‚ö†Ô∏è Por favor ingresa una URL';return;}
if(!url.includes('{N}')){
const matchedPattern=await findMatchingPattern(url);
if(matchedPattern){
url=matchedPattern;
document.getElementById('urlInput').value=url;
status.textContent='‚ú® Patr√≥n detectado autom√°ticamente!';
await new Promise(resolve=>setTimeout(resolve,1000));
}
}
isLoading=true;
loadBtn.disabled=true;
gallery.innerHTML='';
status.textContent='';
allImages=[];
showingAll=false;
downloadSection.style.display='none';
if(url.includes('{N}')){
savePattern(url);
await loadSequence(url);
}else{
await loadSingleImage(url);
}
isLoading=false;
loadBtn.disabled=false;
}
async function loadSingleImage(url){
const status=document.getElementById('status');
const gallery=document.getElementById('gallery');
const downloadSection=document.getElementById('downloadSection');
status.innerHTML='<span class="loading">Cargando imagen</span>';
const img=new Image();
img.onload=()=>{
allImages=[url];
currentImageUrl=url;
showPreview();
status.textContent='‚úÖ Imagen cargada exitosamente';
downloadSection.style.display='block';
};
img.onerror=()=>{status.textContent='‚ùå Error al cargar la imagen';};
img.src=url;
}
async function loadSequence(urlPattern){
const status=document.getElementById('status');
const downloadSection=document.getElementById('downloadSection');
const cachedImages=await getCachedSequence(urlPattern);
if(cachedImages&&cachedImages.length>0){
status.textContent='‚ö° Cargando desde cach√©...';
allImages=cachedImages;
currentImageUrl=allImages[0];
showPreview();
status.textContent=`‚úÖ ${allImages.length} imagen${allImages.length!==1?'es':''} cargada${allImages.length!==1?'s':''} desde cach√©`;
downloadSection.style.display='block';
return;
}
status.innerHTML='<span class="loading">Detectando formato de numeraci√≥n</span>';
let format='normal';
let paddingLength=2;
const testUrl1=urlPattern.replace('{N}','1');
const exists1=await checkImageExists(testUrl1);
if(!exists1){
const testUrl01=urlPattern.replace('{N}','01');
const exists01=await checkImageExists(testUrl01);
if(exists01){format='padded';}else{status.textContent='‚ùå No se encontr√≥ la primera imagen (prob√© con 1 y 01)';return;}
}
status.innerHTML=`<span class="loading">Cargando im√°genes (formato: ${format==='normal'?'1,2,3...':'01,02,03...'})</span>`;
let currentNum=1;
let consecutiveFailures=0;
const maxConsecutiveFailures=3;
while(consecutiveFailures<maxConsecutiveFailures){
const numStr=format==='padded'?String(currentNum).padStart(paddingLength,'0'):String(currentNum);
const imageUrl=urlPattern.replace('{N}',numStr);
const exists=await checkImageExists(imageUrl);
if(exists){allImages.push(imageUrl);consecutiveFailures=0;}else{consecutiveFailures++;}
currentNum++;
status.innerHTML=`<span class="loading">Cargadas: ${allImages.length} im√°genes</span>`;
await new Promise(resolve=>setTimeout(resolve,100));
}
if(allImages.length>0){
await cacheSequence(urlPattern,allImages);
currentImageUrl=allImages[0];
showPreview();
status.textContent=`‚úÖ ${allImages.length} imagen${allImages.length!==1?'es':''} cargada${allImages.length!==1?'s':''} exitosamente`;
downloadSection.style.display='block';
}else{status.textContent='‚ùå No se encontraron im√°genes';}
}
function checkImageExists(url){
return new Promise((resolve)=>{
const img=new Image();
img.onload=()=>resolve(true);
img.onerror=()=>resolve(false);
img.src=url;
setTimeout(()=>resolve(false),5000);
});
}
function showPreview(){
const gallery=document.getElementById('gallery');
gallery.innerHTML='';
if(allImages.length===0)return;
const card=document.createElement('div');
card.className='image-card preview';
card.onclick=openFullscreen;
card.innerHTML=`
<img src="${allImages[0]}" alt="Imagen 1">
<div class="image-number">1</div>
${allImages.length>1?'<div class="click-hint">üëÜ Click para ver todas ('+allImages.length+')</div>':''}
`;
gallery.appendChild(card);
showingAll=false;
currentImageUrl=allImages[0];
}
function openFullscreen(){
const overlay=document.getElementById('fullscreenOverlay');
const fullscreenGallery=document.getElementById('fullscreenGallery');
fullscreenGallery.innerHTML='';
allImages.forEach((url,index)=>{
const img=document.createElement('img');
img.className='fullscreen-image';
img.src=url;
img.alt=`Imagen ${index+1}`;
const container=document.createElement('div');
container.style.position='relative';
container.appendChild(img);
const number=document.createElement('div');
number.className='image-number';
number.textContent=index+1;
container.appendChild(number);
fullscreenGallery.appendChild(container);
});
overlay.classList.add('active');
document.body.style.overflow='hidden';
}
function closeFullscreen(){
const overlay=document.getElementById('fullscreenOverlay');
overlay.classList.remove('active');
document.body.style.overflow='auto';
}
async function downloadAll(){
if(allImages.length===0)return;
const status=document.getElementById('status');
status.innerHTML='<span class="loading">Preparando ZIP con '+allImages.length+' im√°genes</span>';
try{
const zip=new JSZip();
const folder=zip.folder('imagenes');
for(let i=0;i<allImages.length;i++){
status.innerHTML=`<span class="loading">Descargando imagen ${i+1} de ${allImages.length}</span>`;
let downloadUrl=allImages[i];
if(useCorsProxy){
downloadUrl=await tryDownloadWithProxy(allImages[i]);
if(!downloadUrl){
console.error('Proxy fall√≥ para imagen',i+1);
continue;
}
}
const response=await fetch(downloadUrl);
const blob=await response.blob();
const ext=allImages[i].split('.').pop().split('?')[0];
folder.file(`imagen_${i+1}.${ext}`,blob);
await new Promise(resolve=>setTimeout(resolve,300));
}
status.innerHTML='<span class="loading">Generando archivo ZIP</span>';
const zipBlob=await zip.generateAsync({type:'blob'});
const link=document.createElement('a');
link.href=URL.createObjectURL(zipBlob);
link.download='imagenes.zip';
document.body.appendChild(link);
link.click();
document.body.removeChild(link);
URL.revokeObjectURL(link.href);
status.textContent='‚úÖ ZIP descargado exitosamente con '+allImages.length+' im√°genes';
}catch(error){
console.error('Error creando ZIP:',error);
status.textContent='‚ùå Error al crear el ZIP';
}
}
async function tryDownloadWithProxy(url){
for(let i=0;i<corsProxies.length;i++){
try{
const proxyUrl=corsProxies[i]+encodeURIComponent(url);
const response=await fetch(proxyUrl);
if(response.ok){
return proxyUrl;
}
}catch(error){
console.error(`Proxy ${i} fall√≥:`,error);
}
}
return null;
}
document.getElementById('urlInput').addEventListener('keypress',(e)=>{if(e.key==='Enter'){loadImages();}});
initDB();
</script>
</body>
</html>